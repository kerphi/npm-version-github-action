       
name: 'Create Release'

on: 
  workflow_dispatch:
    inputs:
      releaseVersion:
        description: 'Version de la release'     
        required: true
        default: 'x.x.x'

jobs:
  create-release:
    runs-on: ubuntu-latest

    steps:
      - name: 'Checkout source code'
        uses: 'actions/checkout@v2'

      - name: 'Verify version is not already used as a git tag'
        env:
          NEW_TAG:  ${{ github.event.inputs.releaseVersion }}
        run: test $(git tag | grep $NEW_TAG) && echo "$NEW_TAG is already a git tag, choose another one." && exit 1
        
      - name: 'Patch README with the new version'
        env:
          NEW_TAG: ${{ github.event.inputs.releaseVersion }}
        run: |
          git config --global user.email "you@example.com"
          git config --global user.name "Your Name"
          sed -i "s#[0-9]\.[0-9]\.[0-9]#$NEW_TAG#g" README.md
          git commit -m "version" README.md
          git tag $NEW_TAG
          git push && git push --tags
